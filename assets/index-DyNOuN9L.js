var e=Object.defineProperty,t=t=>{let n={};for(var r in t)e(n,r,{get:t[r],enumerable:!0});return n};(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var n=.5,r=2,i=.05,a=`UserZoomMult`,o=500,s=0;function c(e){return Math.max(n,Math.min(r,e))}function l(e){let t=Math.round(e/i)*i;return Number(t.toFixed(3))}function u(){let e=getComputedStyle(document.documentElement).getPropertyValue(`--user-zoom-mult`).trim(),t=Number.parseFloat(e||`1`);(!Number.isFinite(t)||t<=0)&&(t=1);try{let e=localStorage.getItem(a);if(e){let t=Number.parseFloat(e);if(Number.isFinite(t))return c(t)}}catch{}return c(t)}function d(e){let t=l(c(e));document.documentElement.style.setProperty(`--user-zoom-mult`,String(t));try{localStorage.setItem(a,String(t))}catch{}requestAnimationFrame(()=>{window.dispatchEvent(new Event(`resize`))})}function f(e,t,n){let r=document.createElement(e);return t&&(r.className=t),n!=null&&(r.textContent=n),r}function p(){let e=f(`div`,`zoom-controls`);e.setAttribute(`data-zoom-controls`,`true`);let t=f(`button`,`zoom-btn zoom-minus`,`−`);t.type=`button`,t.title=`縮小（−5%）`;let n=f(`span`,`zoom-label`);n.title=`現在のズーム倍率`;let r=f(`button`,`zoom-btn zoom-plus`,`＋`);r.type=`button`,r.title=`拡大（＋5%）`;let a=()=>{n.textContent=`${Math.round(u()*20)*5}%`};a();let c=e=>{let t=performance.now();t-s<o||(d(u()+e),s=t,a())},l=(e,t)=>{let n=null,r=r=>{r.preventDefault(),e.setPointerCapture?.(r.pointerId),c(t),n??=window.setInterval(()=>c(t),o)},i=t=>{t&&e.releasePointerCapture?.(t.pointerId),n!=null&&(clearInterval(n),n=null)};e.addEventListener(`pointerdown`,r),e.addEventListener(`pointerup`,i),e.addEventListener(`pointercancel`,i),e.addEventListener(`pointerleave`,i),window.addEventListener(`blur`,()=>i())};return l(t,-i),l(r,+i),e.appendChild(t),e.appendChild(n),e.appendChild(r),e}function m(){return document.getElementById(`zoom-controls-slot`)}function h(){let e=document.querySelector(`button[data-btn="undo"], button[data-action="undo"]`);if(e||(e=document.querySelector(`button.undo-btn, #undo-btn, #btn-undo`),e))return e;let t=Array.from(document.querySelectorAll(`button`));for(let e of t){let t=(e.textContent||``).trim(),n=t.toUpperCase();if(n===`UNDO`||n.includes(`UNDO`)||t.includes(`戻す`)||t.includes(`取り消し`))return e}return null}function g(){if(document.querySelector(`[data-zoom-controls="true"]`))return{mounted:!0};let e=p(),t=m();if(t){let n=t.querySelector(`[data-zoom-controls="true"]`);return n&&n.remove(),t.appendChild(e),{mounted:!0}}let n=h();if(n&&n.parentElement)return n.insertAdjacentElement(`afterend`,e),{mounted:!0};for(let t of[`#header-actions`,`.header-actions`,`#top-controls`,`.top-controls`,`#hud-actions`,`.hud-actions`]){let n=document.querySelector(t);if(n)return n.appendChild(e),{mounted:!0}}return{mounted:!1}}function _(){getComputedStyle(document.documentElement).getPropertyValue(`--user-zoom-mult`)||document.documentElement.style.setProperty(`--user-zoom-mult`,`1`),d(u())}function ee(){g(),new MutationObserver(()=>{if(!document.querySelector(`[data-zoom-controls="true"]`))g();else{let e=m(),t=document.querySelector(`[data-zoom-controls="true"]`);e&&t&&t.parentElement!==e&&(e.innerHTML=``,e.appendChild(t))}}).observe(document.body,{childList:!0,subtree:!0})}const te={start(){_(),document.readyState===`loading`?document.addEventListener(`DOMContentLoaded`,()=>{setTimeout(ee,0)}):setTimeout(ee,0)}};function ne(e,t){e?.el&&e.el.isConnected&&e.el.classList.remove(`drop-hover`),t?.el&&t.el.isConnected&&t.el.classList.add(`drop-hover`)}function re(e){let t=e.onHoverChange??ne,n=!1,r=!1,i=null,a=null,o=null,s=e.ghostOffset?.x??0,c=e.ghostOffset?.y??0,l=0,u=0,d=null,f=null,p=p=>{if(!n||!a||f!==null&&p.pointerId!==f)return;if(!r){let t=p.clientX-l,n=p.clientY-u;if(t*t+n*n<16)return;r=!0,i=e.buildGhost(a,d),i.classList.add(`drag-ghost`),i.style.position=`fixed`,i.style.left=`0`,i.style.top=`0`,i.style.pointerEvents=`none`,i.style.transform=`translate(${l-s}px, ${u-c}px)`,document.body.appendChild(i),document.body.classList.add(`is-dragging`)}i&&(i.style.transform=`translate(${p.clientX-s}px, ${p.clientY-c}px)`);let m=e.hitTestDest(p.clientX,p.clientY);(m?.el??null)!==(o?.el??null)&&(t(o,m),o=m)},m=()=>{n=!1,r=!1,f=null,i&&i.parentNode&&i.parentNode.removeChild(i),i=null,t(o,null),o=null,window.removeEventListener(`pointermove`,p,!0),window.removeEventListener(`pointerup`,h,!0),window.removeEventListener(`keydown`,g,!0),document.body.classList.remove(`is-dragging`),d=null},h=t=>{if(!n||!a||f!==null&&t.pointerId!==f)return;let i=a;if(a=null,!r){m();return}let o=e.hitTestDest(t.clientX,t.clientY);o&&(!e.canDrop||e.canDrop(i,o.dest))?(m(),e.onDrop(i,o.dest)):(m(),e.onCancel?.(i))},g=t=>{if(!(!n||!a)&&t.key===`Escape`){let t=a;a=null,m(),e.onCancel?.(t)}};return{startDrag:(e,t)=>{if(!n){a=e,n=!0,r=!1,l=t.clientX,u=t.clientY,d=t,f=t.pointerId??null;try{t.target?.setPointerCapture?.(t.pointerId)}catch{}window.addEventListener(`pointermove`,p,!0),window.addEventListener(`pointerup`,h,!0),window.addEventListener(`keydown`,g,!0)}},destroy:()=>{if(n&&a){let t=a;a=null,m(),e.onCancel?.(t)}else n&&m()}}}function ie(e,t){let n=document.elementFromPoint(e,t);return n?n.closest(`[data-drop]`):null}function ae(e,t){let n=document.createElement(`div`);n.style.position=`absolute`,n.style.left=`0`,n.style.top=`0`;let r=()=>{let e=document.createElement(`div`);return e.className=`card back`,n.appendChild(e),n},i=t.target;if(e&&e.srcType===`column`&&typeof e.colIndex==`number`){let t=document.querySelector(`[data-drop="column-${e.colIndex}"]`);if(!t)return r();let i=Array.from(t.querySelectorAll(`.card`));if(!i.length)return r();let a=Math.min(Math.max(e.startIndex??0,0),i.length-1),o=i[a].offsetTop;for(let e=a;e<i.length;e++){let t=i[e],r=t.cloneNode(!0);r.style.transform=`none`,r.style.left=t.style.left||`0px`,r.style.top=`${t.offsetTop-o}px`,n.appendChild(r)}return n}if(e&&e.srcType===`freecell`){let t=document.querySelector(`.freecell-slot-area[data-drop="freecell-${e.freecellIndex}"]`)||i?.closest(`.freecell-slot-area`);if(!t)return r();let a=t.querySelector(`.card`);if(!a)return r();let o=a.cloneNode(!0);return o.style.transform=`none`,o.style.left=`0px`,o.style.top=`0px`,n.appendChild(o),n}if(e&&e.srcType===`foundation`){let t=e.foundationIndex??0,a=document.querySelector(`.foundation-slot-area[data-drop="foundation-${t}"]`)||i?.closest(`.foundation-slot-area`);if(!a)return r();let o=a.querySelector(`.card`);if(!o)return r();let s=o.cloneNode(!0);return s.style.transform=`none`,s.style.left=`0px`,s.style.top=`0px`,n.appendChild(s),n}if(e&&e.srcType===`waste`){let e=i?.closest(`.waste-slot`)||document.querySelector(`.waste-slot`);if(!e)return r();let t=Array.from(e.querySelectorAll(`.card`)),a=t[t.length-1];if(!a)return r();let o=a.cloneNode(!0);return o.style.transform=`none`,o.style.left=`0px`,o.style.top=`0px`,n.appendChild(o),n}if(e&&e.srcType===`tableau`&&typeof e.colIndex==`number`){let t=document.querySelector(`[data-drop="tableau-${e.colIndex}"]`)||i?.closest(`.column-stack`);if(!t)return r();let a=Array.from(t.querySelectorAll(`.card`));if(!a.length)return r();let o=Math.min(Math.max(e.cardIndex??0,0),a.length-1),s=a[o].offsetTop;for(let e=o;e<a.length;e++){let t=a[e],r=t.cloneNode(!0);r.style.transform=`none`,r.style.left=t.style.left||`0px`,r.style.top=`${t.offsetTop-s}px`,n.appendChild(r)}return n}if(!i)return r();let a=i.closest(`.column-stack, .waste-slot, .freecell-slot-area, .foundation-slot-area`);if(!a)return r();let o=i.closest(`.card`),s=o?o.offsetTop:0,c=Array.from(a.querySelectorAll(`.card`));for(let e of c){let t=e.offsetTop;if(t<s)continue;let r=e.cloneNode(!0);r.style.transform=`none`,r.style.left=e.style.left||`0px`,r.style.top=`${t-s}px`,n.appendChild(r)}return n.firstChild?n:r()}var oe=class{seed;constructor(e){this.seed=e>>>0}next(){let e=this.seed>>>0;return e^=e<<13,e>>>=0,e^=e>>17,e>>>=0,e^=e<<5,e>>>=0,this.seed=e>>>0,this.seed}nextFloat(){return this.next()/4294967295}shuffleInPlace(e){for(let t=e.length-1;t>0;t--){let n=Math.floor(this.nextFloat()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}};function se(e){return e===`H`||e===`D`?`red`:`black`}function ce(){let e=[`H`,`D`,`C`,`S`],t=[];for(let n of e)for(let e=1;e<=13;e++)t.push({id:`${n}${e}#0`,suit:n,rank:e,color:se(n)});return t}var le=t({dealFreeCellInitialState:()=>pe,getFreeCellLevelConfig:()=>ue});function ue(e){switch(e){case 1:return{freecellSlots:4};case 2:return{freecellSlots:4};case 3:return{freecellSlots:3};default:return{freecellSlots:4}}}function de(e,t){let n=Array.from({length:8},()=>[]);for(let t=0;t<e.length;t++)n[t%8].push(e[t]);let r=Array.from({length:t},()=>null);return{columns:n,freecells:r,foundations:[[],[],[],[]]}}function fe(e,t,n){let r=t.filter(e=>e.rank<=10),i=t.filter(e=>e.rank>=11);if(r.length<24||i.length<12)return de(t,n);let a=r.slice(),o=i.slice();e.shuffleInPlace(a),e.shuffleInPlace(o);let s=[];for(let e=0;e<8;e++)s.push(a.splice(0,3));let c=a.concat(o);e.shuffleInPlace(c);let l=Array.from({length:8},()=>[]);for(let e=0;e<8;e++){let n=e<4?7:6,r=Math.max(0,n-3);if(c.length<r){let e=r-c.length;c=c.concat(t.slice(0,e))}l[e]=c.splice(0,r).concat(s[e])}let u=Array.from({length:n},()=>null);return{columns:l,freecells:u,foundations:[[],[],[],[]]}}function pe(e,t){let n=new oe(e>>>0),r=ce();n.shuffleInPlace(r);let{freecellSlots:i}=ue(t);return t===1?fe(n,r,i):de(r,i)}var me=t({dealKlondikeInitialState:()=>ve});function he(e){let t=e>>>0;return function(){t+=1831565813;let e=t;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}}function ge(e,t){for(let n=e.length-1;n>0;n--){let r=t()*(n+1)|0,i=e[n];e[n]=e[r],e[r]=i}}function _e(){let e=[`H`,`D`,`C`,`S`],t=[];for(let n of e)for(let e=1;e<=13;e++)t.push({rank:e,suit:n,faceUp:!1});return t}function ve(e,t){let n=he(e),r=_e();ge(r,n);let i=[];for(let e=0;e<7;e++){let t=e+1,n=[];for(let e=0;e<t;e++){let e=r.pop();if(!e)break;n.push({rank:e.rank,suit:e.suit,faceUp:!1})}i.push(n)}for(let e=0;e<i.length;e++){let n=i[e],r=n.length;r&&(n[r-1].faceUp=!0,t===1&&r>=2&&(n[r-2].faceUp=!0))}let a=t>=3?3:1;return{stock:r.map(e=>({rank:e.rank,suit:e.suit,faceUp:!1})),waste:[],foundations:[[],[],[],[]],tableaus:i,drawCount:a}}var ye=t({dealSpiderGame:()=>Ce});function be(e){let t=e>>>0;return function(){return t^=t<<13,t>>>=0,t^=t>>17,t>>>=0,t^=t<<5,t>>>=0,t/4294967296}}function xe(e,t){for(let n=e.length-1;n>0;n--){let r=t()*(n+1)|0,i=e[n];e[n]=e[r],e[r]=i}}function Se(e){let t;t=e<=1?[`S`]:e===2?[`S`,`H`]:[`S`,`H`,`D`,`C`];let n=Math.floor(104/(13*t.length)),r=[];for(let e of t)for(let t=0;t<n;t++)for(let t=1;t<=13;t++)r.push({rank:t,suit:e,faceUp:!1});return r}function Ce(e,t){let n=be(e),r=Se(t);xe(r,n);let i=Array.from({length:10},()=>[]);for(let e=0;e<10;e++){let t=e<4?6:5;for(let n=0;n<t;n++){let a=r.pop();if(!a)throw Error(`Spider配布中にデッキが尽きました`);n===t-1&&(a.faceUp=!0),i[e].push(a)}}return{columns:i,stock:r,completedStacks:0}}function we(e){for(let t of[`dealFreeCellGame`,`dealFreecellGame`,`dealFreeCellInitialState`,`dealFreecellInitialState`,`initFreeCellGame`,`initFreecellGame`,`initFreecell`,`dealFreeCell`,`dealFreecell`])if(typeof e[t]==`function`)return e[t];throw Error(`freecellの初期化関数が見つかりませんでした。deal/freecell側のexport名をご確認ください。`)}function Te(e){for(let t of[`dealKlondikeGame`,`dealKlondikeInitialState`,`initKlondikeGame`,`initKlondike`,`dealKlondike`])if(typeof e[t]==`function`)return e[t];throw Error(`klondikeの初期化関数が見つかりませんでした。deal/klondike側のexport名をご確認ください。`)}function Ee(e){for(let t of[`dealSpiderGame`,`initSpiderGame`,`dealSpiderInitialState`,`initSpider`])if(typeof e[t]==`function`)return e[t];throw Error(`spiderの初期化関数が見つかりませんでした。deal/spider側のexport名をご確認ください。`)}var De=class{mode;level;seed;turnIndex;state;undoStack;moveLog;constructor(e,t,n){if(this.mode=e,this.level=t,this.seed=n,this.turnIndex=0,e===`freecell`)this.state=we(le)(n,t);else if(e===`klondike`)this.state=Te(me)(n,t);else if(e===`spider`)this.state=Ee(ye)(n,t);else throw Error(`未実装モード: `+e);this.undoStack=[],this.moveLog=[]}snapshot(){let e=JSON.parse(JSON.stringify(this.state));this.undoStack.push({state:e,turnIndex:this.turnIndex})}undo(){let e=this.undoStack.pop();return e?(this.state=e.state,this.turnIndex=e.turnIndex,!0):!1}recordMove(e){e!=null&&this.moveLog.push(e)}buildClearReport(e){return{mode:this.mode,level:this.level,seed:this.seed,finalized:e,moveCount:this.moveLog.length,moves:this.moveLog.slice(),finalState:JSON.parse(JSON.stringify(this.state)),timestamp:Date.now()}}};function v(e){switch(e){case`H`:return 0;case`D`:return 1;case`C`:return 2;case`S`:return 3}}function Oe(e,t){let n=v(t),r=e.foundations[n];return!r||r.length===0?1:r[r.length-1].rank+1}function y(e,t){return t.rank===Oe(e,t.suit)}function b(e,t){if(e===null)return!0;let n=e.color!==t.color,r=t.rank===e.rank-1;return n&&r}function ke(e){return e.freecells.reduce((e,t)=>e+(t===null?1:0),0)}function Ae(e){return e.columns.reduce((e,t)=>e+(t.length===0?1:0),0)}function x(e){let t=ke(e),n=Ae(e);return(t+1)*2**n}function S(e,t,n){let r=e.columns[t];if(!r||n<0||n>=r.length)return[];let i=[r[n]];for(let e=n+1;e<r.length;e++){let t=i[i.length-1],n=r[e],a=t.color!==n.color,o=t.rank===n.rank+1;if(a&&o)i.push(n);else break}return n+i.length===r.length?i:[]}function je(e,t,n){let r=x(e);if(t.type===`column`){if(t.index===void 0)return{ok:!1,reason:`column indexなし`};let i=t.index,a=e.columns[i];if(!a||a.length===0)return{ok:!1,reason:`列が空`};let o=t.startIndex===void 0?a.length-1:t.startIndex,s=S(e,i,o);if(s.length===0)return{ok:!1,reason:`その位置のスタックは動かせない`};if(s.length>r)return{ok:!1,reason:`スタックが大きすぎる`};let c=s;if(n.type===`column`){if(n.index===void 0)return{ok:!1,reason:`to column indexなし`};let t=e.columns[n.index],r=t&&t.length>0?t[t.length-1]:null,a=c[0];return b(r,a)?{ok:!0,cards:c,fromDetail:{type:`column`,colIndex:i,startIndex:o},toDetail:{type:`column`,colIndex:n.index},actionType:c.length>1?`MOVE_STACK`:`MOVE_CARD`}:{ok:!1,reason:`列に置けない`}}if(n.type===`freecell`){if(n.index===void 0)return{ok:!1,reason:`to freecell indexなし`};if(e.freecells[n.index]!==null)return{ok:!1,reason:`freecell埋まってる`};let t=a.length-1;return o===t?{ok:!0,cards:[c[0]],fromDetail:{type:`column`,colIndex:i,startIndex:o},toDetail:{type:`freecell`,freecellIndex:n.index},actionType:`MOVE_CARD`}:{ok:!1,reason:`freecellへは一番下の1枚だけ`}}if(n.type===`foundation`){let t=a.length-1;if(o!==t)return{ok:!1,reason:`foundationへは一番下の1枚だけ`};let n=c[0];if(!y(e,n))return{ok:!1,reason:`foundation順NG`};let r=v(n.suit);return{ok:!0,cards:[n],fromDetail:{type:`column`,colIndex:i,startIndex:o},toDetail:{type:`foundation`,foundationIndex:r},actionType:`MOVE_TO_FOUNDATION`}}return{ok:!1,reason:`to不明`}}if(t.type===`freecell`){if(t.index===void 0)return{ok:!1,reason:`freecell indexなし`};let r=t.index,i=e.freecells[r];if(!i)return{ok:!1,reason:`freecell空`};if(n.type===`column`){if(n.index===void 0)return{ok:!1,reason:`to column indexなし`};let t=e.columns[n.index],a=t&&t.length>0?t[t.length-1]:null;return b(a,i)?{ok:!0,cards:[i],fromDetail:{type:`freecell`,freecellIndex:r},toDetail:{type:`column`,colIndex:n.index},actionType:`MOVE_CARD`}:{ok:!1,reason:`列に置けない`}}if(n.type===`foundation`){if(!y(e,i))return{ok:!1,reason:`foundation順NG`};let t=v(i.suit);return{ok:!0,cards:[i],fromDetail:{type:`freecell`,freecellIndex:r},toDetail:{type:`foundation`,foundationIndex:t},actionType:`MOVE_TO_FOUNDATION`}}return n.type===`freecell`?{ok:!1,reason:`freecell->freecell未対応`}:{ok:!1,reason:`to不明`}}if(t.type===`foundation`){if(t.index===void 0)return{ok:!1,reason:`foundation indexなし`};let r=t.index,i=e.foundations[r];if(!i||i.length===0)return{ok:!1,reason:`foundation空`};let a=i[i.length-1];if(n.type===`column`){if(n.index===void 0)return{ok:!1,reason:`to column indexなし`};let t=e.columns[n.index],i=t&&t.length>0?t[t.length-1]:null;return b(i,a)?{ok:!0,cards:[a],fromDetail:{type:`foundation`,foundationIndex:r},toDetail:{type:`column`,colIndex:n.index},actionType:`MOVE_CARD`}:{ok:!1,reason:`列に戻せない`}}return n.type===`freecell`?{ok:!1,reason:`foundation->freecell未対応`}:n.type===`foundation`?{ok:!1,reason:`foundation->foundation無意味`}:{ok:!1,reason:`to不明`}}return{ok:!1,reason:`from不明`}}function Me(e){return{columns:e.columns.map(e=>e.slice()),freecells:e.freecells.slice(),foundations:e.foundations.map(e=>e.slice())}}function Ne(e){return(e.foundations[0]?.length||0)+(e.foundations[1]?.length||0)+(e.foundations[2]?.length||0)+(e.foundations[3]?.length||0)===52}function Pe(e,t,n,r){let i=je(e,t,n);if(!i.ok||!i.cards||!i.fromDetail||!i.toDetail||!i.actionType)return{ok:!1,reason:i.reason||`移動不可`,newState:e};let a=i.cards,o=Me(e);if(i.fromDetail.type===`column`){let e=i.fromDetail.colIndex,t=i.fromDetail.startIndex;o.columns[e].splice(t,a.length)}else if(i.fromDetail.type===`freecell`){let e=i.fromDetail.freecellIndex;o.freecells[e]=null}else if(i.fromDetail.type===`foundation`){let e=i.fromDetail.foundationIndex;o.foundations[e].pop()}else return{ok:!1,reason:`fromDetail.type不明`,newState:e};if(i.toDetail.type===`column`){let e=i.toDetail.colIndex,t=o.columns[e];for(let e of a)t.push(e)}else if(i.toDetail.type===`freecell`){let t=i.toDetail.freecellIndex;if(o.freecells[t]!==null)return{ok:!1,reason:`freecell競合`,newState:e};o.freecells[t]=a[0]}else if(i.toDetail.type===`foundation`){let e=a[0],t=v(e.suit);o.foundations[t].push(e)}else return{ok:!1,reason:`toDetail.type不明`,newState:e};let s={index:r,action:i.actionType,from:{type:i.fromDetail.type,colIndex:i.fromDetail.colIndex,startIndex:i.fromDetail.startIndex,freecellIndex:i.fromDetail.freecellIndex,foundationIndex:i.fromDetail.foundationIndex},to:{type:i.toDetail.type,colIndex:i.toDetail.colIndex,freecellIndex:i.toDetail.freecellIndex,foundationIndex:i.toDetail.foundationIndex},cards:a.map(e=>e.id)},c=Ne(o);return{ok:!0,newState:o,logEntry:s,cleared:c}}function Fe(e,t,n){let r=document.createElement(`div`);r.className=`top-bar`,r.style.display=`flex`,r.style.alignItems=`center`,r.style.gap=`8px`,r.style.flexWrap=`nowrap`;let i=document.createElement(`div`);i.className=`topbar-left`,i.style.display=`flex`,i.style.alignItems=`center`,i.style.gap=`8px`,i.style.flex=`0 0 auto`;let a=document.createElement(`button`);a.className=`back-btn`,a.textContent=`← タイトル`,a.addEventListener(`click`,n.onBackToMenu),i.appendChild(a);let o=document.createElement(`button`);o.className=`back-btn`,o.textContent=`NEW GAME`,o.addEventListener(`click`,n.onNewGameClick),i.appendChild(o);let s=document.createElement(`button`);s.className=`back-btn`,s.textContent=`UNDO`,s.addEventListener(`click`,n.onUndoClick),i.appendChild(s);let c=document.createElement(`div`);c.id=`zoom-controls-slot`,c.className=`zoom-slot`,c.style.display=`flex`,c.style.alignItems=`center`,c.style.gap=`6px`,c.style.marginLeft=`6px`,c.style.flex=`0 0 auto`,i.appendChild(c);let l=document.createElement(`div`);l.className=`topbar-center`,l.style.flex=`1 1 auto`,l.style.minWidth=`0`,l.style.display=`flex`,l.style.justifyContent=`center`;let u=document.createElement(`div`);u.className=`top-bar-log`,u.textContent=t.statusText??``,u.style.whiteSpace=`nowrap`,u.style.overflow=`hidden`,u.style.textOverflow=`ellipsis`,l.appendChild(u);let d=document.createElement(`div`);d.className=`topbar-right`,d.style.display=`flex`,d.style.alignItems=`center`,d.style.gap=`8px`,d.style.flex=`0 0 auto`;let f=document.createElement(`div`);if(f.textContent=`mode: ${e.mode}`,d.appendChild(f),n.onFinishClick&&!t.gameCleared&&(t.readyForFinish||t.finishing)){let e=document.createElement(`button`);e.className=`back-btn finish-btn`,e.textContent=t.finishing?`FINISH中...`:`FINISH`,t.finishing?e.disabled=!0:e.addEventListener(`click`,n.onFinishClick),d.appendChild(e)}return r.appendChild(i),r.appendChild(l),r.appendChild(d),r}function Ie(e,t=`NEW GAME`){let n=document.createElement(`div`);n.className=`overlay`;let r=document.createElement(`div`);r.className=`overlay-panel`;let i=document.createElement(`div`);i.className=`overlay-title`,i.textContent=t,r.appendChild(i);let a=document.createElement(`div`);a.className=`overlay-btn-wrap`;let o=(t,n)=>{let r=document.createElement(`button`);return r.textContent=t,r.className=`overlay-btn`,r.addEventListener(`click`,()=>e.onChooseNewGameOption(n)),r};return a.appendChild(o(`同じ条件でもう一度`,`retry`)),a.appendChild(o(`レベル1`,`level1`)),a.appendChild(o(`レベル2`,`level2`)),a.appendChild(o(`レベル3`,`level3`)),a.appendChild(o(`キャンセル`,`cancel`)),r.appendChild(a),n.appendChild(r),n}function C(e,t){let n=t?.titleText??`CLEAR!`,r=t?.pulse??!0,i=document.createElement(`div`);if(i.style.position=`fixed`,i.style.left=`0`,i.style.top=`0`,i.style.width=`100%`,i.style.height=`100%`,i.style.background=`rgba(0,0,0,0.7)`,i.style.display=`flex`,i.style.flexDirection=`column`,i.style.alignItems=`center`,i.style.justifyContent=`center`,i.style.zIndex=`99999`,i.style.color=`#00ff9c`,i.style.textAlign=`center`,r){let e=document.createElement(`style`);e.textContent=`
@keyframes pulseClear {
  0%   { text-shadow:0 0 10px #00ff9c,0 0 20px #00ff9c; }
  50%  { text-shadow:0 0 20px #ffffff,0 0 40px #00ff9c; }
  100% { text-shadow:0 0 10px #00ff9c,0 0 20px #00ff9c; }
}`,i.appendChild(e)}let a=document.createElement(`div`);a.textContent=n,a.style.fontSize=`64px`,a.style.fontWeight=`bold`,a.style.marginBottom=`24px`,r&&(a.style.animation=`pulseClear 1s infinite`),i.appendChild(a);let o=document.createElement(`div`);o.style.display=`flex`,o.style.flexDirection=`column`,o.style.gap=`12px`;let s=(e,t)=>{let n=document.createElement(`button`);return n.textContent=e,n.style.background=`#222`,n.style.border=`2px solid #00ff9c`,n.style.color=`#00ff9c`,n.style.borderRadius=`8px`,n.style.padding=`12px 20px`,n.style.fontSize=`18px`,n.style.cursor=`pointer`,n.addEventListener(`click`,t),n};return o.appendChild(s(`タイトルへ`,e.onClearToMenuClick)),o.appendChild(s(`もう一度`,e.onClearReplayClick)),i.appendChild(o),i}function w(e){return e===1?`A`:e===11?`J`:e===12?`Q`:e===13?`K`:String(e)}function T(e){switch(e){case`H`:return`♥`;case`D`:return`♦`;case`C`:return`♣`;case`S`:return`♠`}return``}function Le(e){return e===`H`||e===`D`?`red`:`black`}function Re(e){return`card ${Le(e)}`}function ze(e){return`card ${e}`}function Be(e,t){let n=getComputedStyle(document.documentElement).getPropertyValue(e).trim().match(/^(-?\d+(?:\.\d+)?)px$/);return n?parseFloat(n[1]):t}var E=0,D=null;function Ve(e,t){return!e||!t||e.srcType!==t.srcType?!1:e.srcType===`column`&&t.srcType===`column`?e.colIndex===t.colIndex&&e.startIndex===t.startIndex:e.srcType===`freecell`&&t.srcType===`freecell`?e.freecellIndex===t.freecellIndex:e.srcType===`foundation`&&t.srcType===`foundation`?e.foundationIndex===t.foundationIndex:!1}function He(e,t,n,r,i,a,o,s){let c=document.createElement(`div`);c.className=ze(e.color),n&&c.classList.add(`card-head`),r&&c.classList.add(`card-selected-outline`),c.style.top=`${t}px`,c.style.position=`absolute`;let l=document.createElement(`div`);l.className=`card-header`,l.textContent=T(e.suit)+w(e.rank),c.appendChild(l);let u=document.createElement(`div`);return u.className=`card-center`,u.innerHTML=`
    <span class="center-suit">${T(e.suit)}</span>
    <span class="center-rank">${w(e.rank)}</span>
  `,c.appendChild(u),n&&i?(c.addEventListener(`dblclick`,e=>{e.stopPropagation(),a&&(E=0,D=null,o.onAutoToFoundation(i))}),c.addEventListener(`click`,e=>{e.stopPropagation();let t=performance.now();if(a&&Ve(D,i)&&t-E<300){E=0,D=null,o.onAutoToFoundation(i);return}E=t,D=i,o.onSelectSource(i)}),c.addEventListener(`pointerdown`,e=>{e.stopPropagation(),o.onDragStart(i,e)})):s&&c.addEventListener(`click`,e=>{e.stopPropagation(),s()}),c}function Ue(e,t,n,r,i,a,o,s,c){let l=t.state;e.innerHTML=``;let u=document.createElement(`div`);u.className=`game-root`;let d=document.createElement(`div`);d.className=`board-frame`,u.appendChild(d);let f=Fe(t,{statusText:n.statusText,readyForFinish:a,finishing:o,gameCleared:s},{onBackToMenu:()=>c.onBackToMenu(),onNewGameClick:()=>c.onNewGameClick(),onUndoClick:()=>c.onUndoClick(),onFinishClick:()=>c.onFinishClick()});d.appendChild(f);let p=document.createElement(`div`);p.className=`board freecell-board`;let m=document.createElement(`div`);m.className=`board-top-row`;let h=document.createElement(`div`);h.className=`freecell-group`,l.freecells.forEach((e,t)=>{let n=document.createElement(`div`);if(n.className=`slot freecell-slot-area`,n.dataset.drop=`freecell-${t}`,n.addEventListener(`click`,e=>{e.stopPropagation(),E=0,D=null,c.onClickDestination({destType:`freecell`,freecellIndex:t})}),e){let a=!!r.freecells[t],o=!!i.freecells[t],s=He(e,0,a,o,a?{srcType:`freecell`,freecellIndex:t}:null,!0,c);h.appendChild(n),n.appendChild(s)}else h.appendChild(n)}),m.appendChild(h);let g=document.createElement(`div`);g.className=`foundation-group`,l.foundations.forEach((e,t)=>{let n=document.createElement(`div`);n.className=`slot foundation-slot-area`,n.dataset.drop=`foundation-${t}`,n.addEventListener(`click`,e=>{e.stopPropagation(),E=0,D=null,c.onClickDestination({destType:`foundation`,foundationIndex:t})});let a=e.length>0?e[e.length-1]:null;if(a){let e=!!r.foundations[t],o=!!i.foundations[t],s=He(a,0,e,o,e?{srcType:`foundation`,foundationIndex:t}:null,!1,c);s.classList.add(`foundation-card`),g.appendChild(n),n.appendChild(s)}else g.appendChild(n)}),m.appendChild(g),p.appendChild(m);let _=document.createElement(`div`);_.className=`columns-area`;let ee=Be(`--freecell-gap`,20);l.columns.forEach((e,t)=>{let n=document.createElement(`div`);n.className=`column-stack`,n.dataset.drop=`column-${t}`,n.addEventListener(`click`,e=>{e.stopPropagation(),E=0,D=null,c.onClickDestination({destType:`column`,colIndex:t})}),e.forEach((e,a)=>{let o=!!(r.columns[t]&&r.columns[t][a]),s=!!(i.columns[t]&&i.columns[t][a]),l=o?{srcType:`column`,colIndex:t,startIndex:a}:null,u=He(e,a*ee,o,s,l,!0,c,()=>{c.onColumnCardTap(t,a)});n.appendChild(u)}),_.appendChild(n)}),p.appendChild(_),p.addEventListener(`click`,()=>{E=0,D=null,c.onEmptyBoardClick()}),d.appendChild(p),n.showNewGameMenu&&!s&&u.appendChild(Ie({onChooseNewGameOption:c.onChooseNewGameOption})),s&&u.appendChild(C({onClearToMenuClick:c.onClearToMenuClick,onClearReplayClick:c.onClearReplayClick},{titleText:`CLEAR!`,pulse:!0})),e.appendChild(u)}function O(e){return e.suit===`H`||e.suit===`D`?`red`:`black`}function We(e){return{stock:e.stock.map(e=>({...e})),waste:e.waste.map(e=>({...e})),foundations:e.foundations.map(e=>e.map(e=>({...e}))),tableaus:e.tableaus.map(e=>e.map(e=>({...e}))),drawCount:e.drawCount}}function Ge(e,t){for(let n=t;n<e.length;n++)if(!e[n].faceUp)return!1;for(let n=t;n<e.length-1;n++){let t=e[n],r=e[n+1];if(!t.faceUp||!r.faceUp||t.rank!==r.rank+1||O(t)===O(r))return!1}return!0}function Ke(e,t,n){let r=e.tableaus[t];return!r||n<0||n>=r.length||!Ge(r,n)?[]:r.slice(n)}function qe(e,t){if(!t.length)return e.rank===1;let n=t[t.length-1];return e.suit===n.suit&&e.rank===n.rank+1}function Je(e,t){if(!t.length)return e.rank===13;let n=t[t.length-1];return!n.faceUp||O(e)===O(n)?!1:e.rank===n.rank-1}function Ye(e){for(let t=0;t<e.foundations.length;t++)if(e.foundations[t].length!==13)return!1;return!0}function Xe(e,t,n,r){let i=We(e),a=[];if(t.type===`waste`){if(!i.waste.length)return{ok:!1,reason:`wasteが空`};let e=i.waste[i.waste.length-1];if(!e.faceUp)return{ok:!1,reason:`wasteが裏`};a=[e]}else if(t.type===`foundation`){let e=i.foundations[t.foundationIndex];if(!e.length)return{ok:!1,reason:`foundationが空`};a=[e[e.length-1]]}else{let e=i.tableaus[t.colIndex];if(!e)return{ok:!1,reason:`bad tableau col`};if(t.cardIndex<0||t.cardIndex>=e.length)return{ok:!1,reason:`bad cardIndex`};let n=Ke(i,t.colIndex,t.cardIndex);if(!n.length)return{ok:!1,reason:`その位置からは動かせない`};a=n}if(n.type===`foundation`){let e=n.foundationIndex;if(a.length!==1)return{ok:!1,reason:`foundationへは1枚のみ`};let r=a[0],o=i.foundations[e];if(!qe(r,o))return{ok:!1,reason:`foundationに置けない`};if(t.type===`waste`)i.waste.pop();else if(t.type===`foundation`)return{ok:!1,reason:`foundation同士は不可`};else{i.tableaus[t.colIndex]=i.tableaus[t.colIndex].slice(0,t.cardIndex);let e=i.tableaus[t.colIndex];e.length>0&&(e[e.length-1].faceUp=!0)}return o.push(r),{ok:!0,newState:i,logEntry:{type:`move-to-foundation`,card:r},cleared:Ye(i)}}if(n.type===`tableau`){let e=i.tableaus[n.colIndex];if(!e)return{ok:!1,reason:`bad dst tableau`};let r=a[0];if(!Je(r,e))return{ok:!1,reason:`tableauに置けない`};if(t.type===`waste`)i.waste.pop();else if(t.type===`foundation`)i.foundations[t.foundationIndex].pop();else{i.tableaus[t.colIndex]=i.tableaus[t.colIndex].slice(0,t.cardIndex);let e=i.tableaus[t.colIndex];e.length>0&&(e[e.length-1].faceUp=!0)}return e.push(...a),{ok:!0,newState:i,logEntry:{type:`move-to-tableau`,cards:a},cleared:Ye(i)}}return{ok:!1,reason:`unknown dest`}}function k(e,t){let n=getComputedStyle(document.documentElement).getPropertyValue(e).trim().match(/^(-?\d+(?:\.\d+)?)px$/);return n?parseFloat(n[1]):t}function Ze(e,t){let n=getComputedStyle(document.documentElement).getPropertyValue(e).trim(),r=parseFloat(n);return Number.isFinite(r)?r:t}function Qe(e){let t=T(e);return t===`♥`||t===`♦`?`red`:`black`}function $e(e,t,n){let r=e.tableaus[t],i=r[n];if(!i||!i.faceUp)return!1;for(let e=n;e<r.length-1;e++){let t=r[e],n=r[e+1];if(!t.faceUp||!n.faceUp||t.rank!==n.rank+1||Qe(t.suit)===Qe(n.suit))return!1}return!0}function A(e,t,n,r,i){let a=e.selectedFrom;return a?t===`tableau`&&a.srcType===`tableau`?a.colIndex===n&&r>=a.cardIndex:t===`waste`&&a.srcType===`waste`?r===i-1:t===`foundation`&&a.srcType===`foundation`?a.foundationIndex===n&&r===i-1:!1:!1}function j(e,t,n,r,i,a,o,s){let c=document.createElement(`div`);if(!e.faceUp)c.className=`card back`;else{c.className=Re(e.suit);let t=document.createElement(`div`);t.className=`card-header`,t.textContent=T(e.suit)+w(e.rank),c.appendChild(t);let n=document.createElement(`div`);n.className=`card-center`,n.innerHTML=`
      <span class="center-suit">${T(e.suit)}</span>
      <span class="center-rank">${w(e.rank)}</span>
    `,c.appendChild(n)}if(t&&c.classList.add(`card-selected-outline`),c.style.position=`absolute`,c.style.left=`${n}px`,c.style.top=`${r}px`,e.faceUp&&i){let e=0;o&&c.addEventListener(`dblclick`,e=>{e.stopPropagation(),a.onAutoToFoundation(i)}),c.addEventListener(`click`,t=>{t.stopPropagation();let n=performance.now();if(o&&n-e<300){e=0,a.onAutoToFoundation(i);return}e=n,a.onSelectSource(i)}),c.addEventListener(`pointerdown`,e=>{e.stopPropagation(),a.onDragStart(i,e)})}else s&&c.addEventListener(`click`,e=>{e.stopPropagation(),s()});return c}function et(e,t){let n=document.createElement(`div`);n.className=`slot stock-slot`,n.style.position=`relative`,n.dataset.stock=`1`,n.addEventListener(`click`,e=>{e.stopPropagation(),t.onStockClick()});let r=e.stock.length;if(r>0){let e=document.createElement(`div`);e.className=`card back`,e.style.position=`absolute`,e.style.left=`0px`,e.style.top=`0px`,n.appendChild(e);let t=document.createElement(`div`);t.className=`stock-count`,t.textContent=String(r),n.appendChild(t)}return n}function tt(e,t,n){let r=k(`--card-w`,72),i=k(`--waste-step-x`,27),a=k(`--waste-step-y`,4),o=Ze(`--waste-scale`,.9),s=e.waste.length,c=document.createElement(`div`);c.className=`slot waste-slot`,c.style.position=`relative`;let l=r+i*Math.max(0,s-1);if(c.style.width=`${l}px`,s===0)return c;for(let r=0;r<s;r++){let l=e.waste[r],u=r===s-1,d=A(t,`waste`,0,r,s),f=u?{srcType:`waste`}:null,p=j(l,d,r*i,a,f,n,!0);p.style.transform=`scale(${o})`,p.style.transformOrigin=`top left`,u&&l.faceUp&&(p.dataset.srcType=`waste`),c.appendChild(p)}return c}function nt(e,t,n){let r=document.createElement(`div`);r.className=`foundation-group`;for(let i=0;i<e.foundations.length;i++){let a=e.foundations[i],o=document.createElement(`div`);if(o.className=`slot foundation-slot-area`,o.dataset.drop=`foundation-${i}`,o.addEventListener(`click`,e=>{e.stopPropagation(),n.onClickDestination({destType:`foundation`,foundationIndex:i})}),a.length>0){let e=a[a.length-1],r=A(t,`foundation`,i,a.length-1,a.length),s=j(e,r,0,0,{srcType:`foundation`,foundationIndex:i},n,!1);s.classList.add(`foundation-card`),s.dataset.srcType=`foundation`,s.dataset.foundationIndex=String(i),o.appendChild(s)}r.appendChild(o)}return r}function rt(e,t,n){let r=k(`--gap-faceup`,24),i=k(`--gap-facedown`,16),a=document.createElement(`div`);a.className=`columns-area`;let o=e.tableaus;for(let s=0;s<o.length;s++){let c=o[s],l=document.createElement(`div`);l.className=`column-stack`,l.dataset.drop=`tableau-${s}`,l.addEventListener(`click`,e=>{e.target.closest(`.card`)||(e.stopPropagation(),n.onClickDestination({destType:`tableau`,colIndex:s}))});let u=0;for(let a=0;a<c.length;a++){let o=c[a],d=A(t,`tableau`,s,a,c.length),f=o.faceUp&&$e(e,s,a),p=j(o,d,0,u,f?{srcType:`tableau`,colIndex:s,cardIndex:a}:null,n,!0,!f&&o.faceUp?()=>n.onColumnCardTap(s,a):void 0);p.dataset.srcType=`tableau`,p.dataset.colIndex=String(s),p.dataset.cardIndex=String(a),l.appendChild(p),u+=o.faceUp?r:i}a.appendChild(l)}return a}function it(e,t,n,r,i,a,o){let s=t.state;e.innerHTML=``;let c=document.createElement(`div`);c.className=`game-root`;let l=document.createElement(`div`);l.className=`board-frame`,c.appendChild(l);let u=Fe(t,{statusText:n.statusText,readyForFinish:r,finishing:i,gameCleared:a},{onBackToMenu:()=>o.onBackToMenu(),onNewGameClick:()=>o.onNewGameClick(),onUndoClick:()=>o.onUndoClick(),onFinishClick:()=>o.onFinishClick()});l.appendChild(u);let d=document.createElement(`div`);d.className=`board klondike-board`;let f=document.createElement(`div`);f.className=`board-top-row`;let p=document.createElement(`div`);p.className=`stock-waste-group`,p.appendChild(et(s,o));let m=nt(s,n,o);f.appendChild(p),f.appendChild(m),d.appendChild(f);let h=document.createElement(`div`);h.className=`draw-row`,h.appendChild(tt(s,n,o)),d.appendChild(h);let g=rt(s,n,o);d.appendChild(g),d.addEventListener(`click`,()=>{o.onEmptyBoardClick()}),l.appendChild(d),n.showNewGameMenu&&!a&&c.appendChild(Ie({onChooseNewGameOption:o.onChooseNewGameOption})),a&&c.appendChild(C({onClearToMenuClick:o.onClearToMenuClick,onClearReplayClick:o.onClearReplayClick},{titleText:`CLEAR!`,pulse:!0})),e.appendChild(c)}function M(e,t){let n=getComputedStyle(document.documentElement).getPropertyValue(e).trim().match(/^(-?\d+(?:\.\d+)?)px$/);return n?parseFloat(n[1]):t}function at(e,t){let n=e[t];if(!n||!n.faceUp)return!1;for(let n=t;n<e.length-1;n++){let t=e[n],r=e[n+1];if(!t.faceUp||!r.faceUp||t.suit!==r.suit||t.rank!==r.rank+1)return!1}return!0}function ot(e,t,n,r,i,a){let o=t.state;e.innerHTML=``;let s=document.createElement(`div`);s.className=`game-root`;let c=document.createElement(`div`);c.className=`board-frame`,s.appendChild(c);let l=Fe(t,{statusText:n.statusText,readyForFinish:!1,finishing:!1,gameCleared:i||n.cleared},{onBackToMenu:()=>a.onBackToMenu(),onNewGameClick:()=>a.onNewGameClick(),onUndoClick:()=>a.onUndoClick()});c.appendChild(l);let u=document.createElement(`div`);u.className=`board spider-board`,u.addEventListener(`click`,()=>{a.onEmptyBoardClick()});let d=document.createElement(`div`);d.className=`board-top-row`;{let e=document.createElement(`div`);e.className=`stock-waste-group`;let t=document.createElement(`div`);if(t.className=`slot`,t.dataset.drop=``,t.style.position=`relative`,t.style.cursor=`pointer`,o.stock&&o.stock.length>0){let e=Math.floor(o.stock.length/10),n=document.createElement(`div`);n.className=`stock-count`,n.textContent=`${e}回`,t.appendChild(n)}t.addEventListener(`click`,()=>{a.onStockClick()}),e.appendChild(t),d.appendChild(e)}{let e=document.createElement(`div`);e.className=`foundation-group`;let t=document.createElement(`div`);t.className=`slot spider-done`,t.style.cursor=`default`,t.style.color=`#00ff9c`,t.style.fontWeight=`700`,t.style.fontSize=`20px`,t.style.textAlign=`center`,t.style.lineHeight=`var(--card-h, 100px)`,t.textContent=`${o.completedStacks}/8`,e.appendChild(t),d.appendChild(e)}u.appendChild(d);let f=document.createElement(`div`);f.className=`columns-area`;let p=M(`--column-top-padding`,4),m=M(`--gap-faceup`,24),h=M(`--gap-facedown`,16);o.columns.forEach((e,t)=>{let i=document.createElement(`div`);i.className=`column-stack`,i.dataset.drop=`tableau-${t}`,i.addEventListener(`click`,r=>{if(r.target.closest(`.card`))return;if(n.selectedFrom){a.onClickDestination({destType:`tableau`,colIndex:t});return}let i=e.length-1;i>=0?a.onColumnCardTap(t,i):a.onEmptyBoardClick()});let o=p;for(let n=0;n<e.length;n++){let s=e[n],c=s.faceUp,l=document.createElement(`div`);c?l.className=Re(s.suit):l.className=`card back`,l.style.position=`absolute`,l.style.top=o+`px`,l.style.left=`0px`;let u=c&&at(e,n);if(c&&u&&l.addEventListener(`pointerdown`,e=>{e.stopPropagation();let r={srcType:`tableau`,colIndex:t,cardIndex:n};a.onSelectSource(r),a.onDragStart(r,e)}),l.addEventListener(`click`,e=>{e.stopPropagation(),a.onColumnCardTap(t,n)}),c){let e=document.createElement(`div`);e.className=`card-header`,e.textContent=T(s.suit)+w(s.rank),l.appendChild(e);let t=document.createElement(`div`);t.className=`card-center`,t.innerHTML=`
          <span class="center-suit">${T(s.suit)}</span>
          <span class="center-rank">${w(s.rank)}</span>
        `,l.appendChild(t)}let d=r.columns[t];d&&d[n]&&l.classList.add(`card-selected-outline`),i.appendChild(l),o+=c?m:h}f.appendChild(i)}),u.appendChild(f),c.appendChild(u),(i||n.cleared)&&s.appendChild(C({onClearToMenuClick:a.onClearToMenuClick,onClearReplayClick:a.onClearReplayClick},{titleText:`クリア！`,pulse:!0})),n.showNewGameMenu&&!n.cleared&&!i&&s.appendChild(Ie({onChooseNewGameOption:a.onChooseNewGameOption})),e.appendChild(s)}function st(e,t,n){e.innerHTML=``;let r=document.createElement(`div`);r.className=`menu-screen`;let i=document.createElement(`h1`);i.className=`menu-title`,i.textContent=`ソリティア`,r.appendChild(i);let a=document.createElement(`div`);if(a.className=`menu-subtitle`,a.textContent=`遊びたいゲームを選んでください`,r.appendChild(a),!t){let t=document.createElement(`div`);t.className=`menu-list`;{let e=document.createElement(`button`);e.className=`menu-btn active`,e.textContent=`フリーセル`,e.addEventListener(`click`,()=>{n.onSelectMode(`freecell`)}),t.appendChild(e)}{let e=document.createElement(`button`);e.className=`menu-btn active`,e.textContent=`クロンダイク`,e.addEventListener(`click`,()=>{n.onSelectMode(`klondike`)}),t.appendChild(e)}{let e=document.createElement(`button`);e.className=`menu-btn active`,e.textContent=`スパイダー`,e.addEventListener(`click`,()=>{n.onSelectMode(`spider`)}),t.appendChild(e)}r.appendChild(t),e.appendChild(r);return}let o=document.createElement(`div`);o.className=`menu-mode-label`,o.textContent=`モード: ${t}`,r.appendChild(o);let s=document.createElement(`div`);s.className=`menu-list`;{let e=document.createElement(`button`);e.className=`menu-btn active`,e.textContent=`レベル1`,e.addEventListener(`click`,()=>{n.onStartGame(t,1)}),s.appendChild(e)}{let e=document.createElement(`button`);e.className=`menu-btn active`,e.textContent=`レベル2`,e.addEventListener(`click`,()=>{n.onStartGame(t,2)}),s.appendChild(e)}{let e=document.createElement(`button`);e.className=`menu-btn active`,e.textContent=`レベル3`,e.addEventListener(`click`,()=>{n.onStartGame(t,3)}),s.appendChild(e)}r.appendChild(s);let c=document.createElement(`button`);c.className=`menu-back-btn`,c.textContent=`← ゲーム選択に戻る`,c.addEventListener(`click`,()=>{n.onBackModeSelect()}),r.appendChild(c),e.appendChild(r)}var ct=`ClearSeedLogV1`,lt=45e5;function ut(e){return e===`freecell`?0:e===`klondike`?1:2}function dt(){try{return localStorage.getItem(ct)||``}catch{return``}}function ft(e){try{localStorage.setItem(ct,e)}catch{}}function pt(){let e=dt();if(e.length<=lt)return;let t=e.split(`
`);t.length&&t[t.length-1]===``&&t.pop();let n=Math.floor(t.length/2),r=t.slice(n).join(`
`);ft(r+`
`)}function mt(e){let t=dt(),n=t&&!t.endsWith(`
`)?t+`
`:t;ft(n+e+`
`),pt()}var N=`menu`,P=void 0,F=null,I={selectedFrom:void 0,statusText:``,cleared:!1,showNewGameMenu:!1},L=!1,R=null;function ht(e){return e===1?`A`:e===11?`J`:e===12?`Q`:e===13?`K`:String(e)}function gt(e){switch(e){case`H`:return`♥`;case`D`:return`♦`;case`C`:return`♣`;case`S`:return`♠`}return``}function z(e){return e?`${gt(e.suit)}${ht(e.rank)}`:``}function B(e,t){if(t.srcType===`column`){let n=e.columns[t.colIndex];return n?.length?n[t.startIndex]:null}else if(t.srcType===`freecell`)return e.freecells[t.freecellIndex]||null;else{let n=e.foundations[t.foundationIndex];return n?.length?n[n.length-1]:null}}function V(e,t){if(t.srcType===`tableau`){let n=e.tableaus[t.colIndex];return n?.length?n[t.cardIndex]:null}else if(t.srcType===`waste`){let t=e.waste;return t?.length?t[t.length-1]:null}else{let n=e.foundations[t.foundationIndex];return n?.length?n[n.length-1]:null}}function _t(e,t){if(t.srcType!==`tableau`)return null;let n=e.columns[t.colIndex];return n?.length?n[t.cardIndex]:null}function vt(e){return{columns:e.columns.map(e=>e.slice()),freecells:e.freecells.slice(),foundations:e.foundations.map(e=>e.slice())}}function yt(e){let t=0;for(let n=0;n<e.foundations.length;n++)t+=e.foundations[n].length;return t===52}function H(e,t){let n={H:t[0].length,D:t[1].length,C:t[2].length,S:t[3].length},r=e.rank;if(r<=2)return!0;if(e.color===`red`){let e=Math.min(n.S,n.C);return r<=e+1}else{let e=Math.min(n.H,n.D);return r<=e+1}}function bt(e){let t=vt(e);for(;;){let e=!1;for(let n=0;n<t.freecells.length;n++){let r=t.freecells[n];if(r&&y(t,r)&&H(r,t.foundations)){t.freecells[n]=null,t.foundations[v(r.suit)].push(r),e=!0;break}}if(!e){for(let n=0;n<t.columns.length;n++){let r=t.columns[n];if(!r.length)continue;let i=r[r.length-1];if(y(t,i)&&H(i,t.foundations)){r.pop(),t.foundations[v(i.suit)].push(i),e=!0;break}}if(!e)break}}return yt(t)}function xt(){if(!F)return!1;let e=F.state;for(let t=0;t<e.freecells.length;t++){let n=e.freecells[t];if(n&&y(e,n)&&H(n,e.foundations)&&U({srcType:`freecell`,freecellIndex:t},{destType:`foundation`}).ok)return!0}for(let t=0;t<e.columns.length;t++){let n=e.columns[t];if(!n.length)continue;let r=n[n.length-1];if(y(e,r)&&H(r,e.foundations)){let e={srcType:`column`,colIndex:t,startIndex:n.length-1};if(U(e,{destType:`foundation`}).ok)return!0}}return!1}function St(e){return e.srcType===`column`?{type:`column`,index:e.colIndex,startIndex:e.startIndex}:e.srcType===`freecell`?{type:`freecell`,index:e.freecellIndex}:{type:`foundation`,index:e.foundationIndex}}function Ct(e){return e.destType===`column`?{type:`column`,index:e.colIndex}:e.destType===`freecell`?{type:`freecell`,index:e.freecellIndex}:{type:`foundation`,index:e.foundationIndex}}function U(e,t){if(!F)return{ok:!1,reason:`no session`};if(e.srcType===`column`&&t.destType===`column`&&e.colIndex===t.colIndex)return I.selectedFrom=void 0,I.statusText=`選択解除`,$(),{ok:!1,reason:`same column`};if(e.srcType===`freecell`&&t.destType===`freecell`&&e.freecellIndex===t.freecellIndex)return I.selectedFrom=void 0,I.statusText=`選択解除`,$(),{ok:!1,reason:`same freecell`};if(e.srcType===`foundation`&&t.destType===`foundation`&&t.foundationIndex!==void 0&&e.foundationIndex===t.foundationIndex)return I.selectedFrom=void 0,I.statusText=`選択解除`,$(),{ok:!1,reason:`same foundation`};let n=F.state,r=B(n,e),i=z(r),a=St(e),o=Ct(t),s=Pe(F.state,a,o,F.turnIndex);if(!s.ok)return I.statusText=`移動不可`,$(),{ok:!1,reason:s.reason};if(F.snapshot(),F.state=s.newState,F.recordMove(s.logEntry),s.cleared&&!I.cleared){J(),I.cleared=!0,I.statusText=`クリア！`,q(F);let e=F.buildClearReport(!0);console.log(`CLEAR REPORT:`,e)}else I.cleared||(I.statusText=`${i} 移動`);return I.selectedFrom=void 0,$(),{ok:!0}}function wt(e){return e.srcType===`tableau`?{type:`tableau`,colIndex:e.colIndex,cardIndex:e.cardIndex}:e.srcType===`waste`?{type:`waste`}:{type:`foundation`,foundationIndex:e.foundationIndex}}function Tt(e){return e.destType===`tableau`?{type:`tableau`,colIndex:e.colIndex}:{type:`foundation`,foundationIndex:e.foundationIndex}}function W(e,t){if(!F)return{ok:!1,reason:`no session`};if(e.srcType===`tableau`&&t.destType===`tableau`&&e.colIndex===t.colIndex)return I.selectedFrom=void 0,I.statusText=`選択解除`,$(),{ok:!1,reason:`same tableau`};if(e.srcType===`foundation`&&t.destType===`foundation`&&e.foundationIndex===t.foundationIndex)return I.selectedFrom=void 0,I.statusText=`選択解除`,$(),{ok:!1,reason:`same foundation`};let n=F.state,r=V(n,e),i=z(r),a=Xe(F.state,wt(e),Tt(t),F.turnIndex);if(!a.ok||!a.newState)return I.statusText=`移動不可`,$(),{ok:!1,reason:a.reason};if(F.snapshot(),F.state=a.newState,a.logEntry&&F.recordMove(a.logEntry),a.cleared&&!I.cleared){J(),I.cleared=!0,I.statusText=`クリア！`,q(F);let e=F.buildClearReport(!0);console.log(`CLEAR REPORT:`,e)}else I.cleared||(I.statusText=`${i} 移動`);return I.selectedFrom=void 0,$(),{ok:!0}}function Et(e){if(!F)return;let t=F.state;for(let n=0;n<t.foundations.length;n++)if(W(e,{destType:`foundation`,foundationIndex:n}).ok)return;I.statusText=`移動不可`,$()}function Dt(e){for(let t=0;t<e.tableaus.length;t++){let n=e.tableaus[t];for(let e=0;e<n.length;e++)if(!n[e].faceUp)return!1}return!0}function Ot(e){let t=0;for(let n=0;n<e.foundations.length;n++)t+=e.foundations[n].length;return t===52}function kt(e){let t=e.stock.length===0,n=e.waste.length===0,r=Dt(e);return t&&n&&r}function At(e,t){return e.srcType===`tableau`&&t.srcType===`tableau`&&e.colIndex===t.colIndex&&e.cardIndex===t.cardIndex}function G(e,t){if(!t||t.srcType!==`tableau`)return[];let n=e.columns[t.colIndex];if(!n)return[];let r=t.cardIndex;if(r<0||r>=n.length)return[];let i=n[r];if(!i.faceUp)return[];let a=i.suit,o=i.rank,s=[i];for(let e=r+1;e<n.length;e++){let t=n[e];if(!t.faceUp||t.suit!==a||t.rank!==o-1)return[];s.push(t),o=t.rank}return s}function jt(e,t){if(t.length===0)return!1;if(e.length===0)return!0;let n=e[e.length-1];return n.faceUp?t[0].rank===n.rank-1:!1}function Mt(e,t){let n=e.slice(t);return e.splice(t,n.length),n}function Nt(e){if(e.length===0)return;let t=e[e.length-1];t.faceUp||=!0}function Pt(e,t){if(!F)return{ok:!1,reason:`no session`};if(F.mode!==`spider`)return{ok:!1,reason:`not spider`};if((window.spiderAnim||{active:!1,timer:null}).active)return I.statusText=`移動不可`,$(),{ok:!1,reason:`anim`};let n=F.state;if(!e||e.srcType!==`tableau`||!t||t.destType!==`tableau`)return I.statusText=`移動不可`,$(),{ok:!1,reason:`bad ref`};let r=e.colIndex,i=e.cardIndex,a=t.colIndex;if(r===a)return I.selectedFrom=void 0,I.statusText=`選択解除`,$(),{ok:!1,reason:`same column`};let o=n.columns[r],s=n.columns[a];if(!o||!s)return I.statusText=`移動不可`,$(),{ok:!1,reason:`bad column`};let c=G(n,{srcType:`tableau`,colIndex:r,cardIndex:i});if(!c.length)return I.statusText=`動かせない`,$(),{ok:!1,reason:`no movable seq`};if(!jt(s,c))return I.statusText=`移動不可`,$(),{ok:!1,reason:`cant place`};let l=o[i],u=z(l);F.snapshot();let d=Mt(o,i);for(let e=0;e<d.length;e++)s.push(d[e]);return Nt(o),I.selectedFrom=void 0,I.cleared=!1,I.statusText=`${u} 移動`,F.recordMove({type:`spiderMove`,fromColIndex:r,fromStartIdx:i,toColIndex:a,movedLen:d.length}),$(),K(),{ok:!0}}function Ft(e){let t=!e.stock||e.stock.length===0,n=e.columns.every(e=>e.length===0);return t&&n}function It(){if(!F||F.mode!==`spider`)return;let e=F.state;if((window.spiderAnim||{active:!1,timer:null}).active){I.statusText=`回収中でございます`,$();return}if(e.columns.some(e=>e.length===0)){I.statusText=`空の列があるので配れません`,$();return}if(!e.stock||e.stock.length<10){I.statusText=`山札なし`,$();return}F.snapshot();for(let t=0;t<10;t++){let n=e.stock.pop();if(!n)break;n.faceUp=!0,e.columns[t].push(n)}I.selectedFrom=void 0,I.cleared=!1,I.statusText=`山札を配りました`,F.recordMove({type:`spiderDeal`}),$(),K()}function Lt(e){for(let t=0;t<e.columns.length;t++){let n=e.columns[t];if(n.length<13)continue;let r=n.length-13,i=n[r].suit,a=!0;for(let e=0;e<13;e++){let t=n[r+e],o=13-e;if(!t.faceUp){a=!1;break}if(t.suit!==i){a=!1;break}if(t.rank!==o){a=!1;break}}if(a)return{colIndex:t,startIdx:r}}return null}function Rt(e){let t=document.querySelector(`[data-drop="tableau-${e}"]`);t&&(t.classList.add(`spider-column-flash`),setTimeout(()=>{t.classList.remove(`spider-column-flash`)},300))}function K(){if(!F||F.mode!==`spider`)return;let e=F.state,t=window.spiderAnim||(window.spiderAnim={active:!1,timer:null});if(t.active)return;let n=Lt(e);if(!n){if(Ft(e)&&!I.cleared){J(),I.cleared=!0,I.statusText=`クリア！`,q(F);let e=F.buildClearReport(!0);console.log(`CLEAR REPORT:`,e),$()}return}let{colIndex:r,startIdx:i}=n;t.active=!0;function a(){if(!F||F.mode!==`spider`)t.active=!1;else{let e=F.state,n=e.columns[r];Nt(n),e.completedStacks++,$(),Rt(r),t.active=!1,t.timer=null,setTimeout(()=>{K()},100)}}function o(){if(!t.active){t.timer=null;return}if(!F||F.mode!==`spider`){t.active=!1,t.timer=null;return}let e=F.state.columns[r];if(e.length<=i){t.timer=null,a();return}e.pop(),$(),t.timer=window.setTimeout(o,50)}o()}window.spiderAnim=window.spiderAnim||{active:!1,timer:null},window.spiderAfterMutation=K;function zt(e,t){let n={};if(!t||t.srcType!==`tableau`)return{columns:n};let r=t.colIndex,i=G(e,t);if(!i.length)return{columns:n};let a=t.cardIndex,o=a+i.length-1;for(let e=a;e<=o;e++)n[r]||(n[r]={}),n[r][e]=!0;return{columns:n}}function Bt(e,t){if(I.cleared||!F||F.mode!==`spider`)return;let n=F.state,r=n.columns[e];if(!r||!r.length){I.selectedFrom=void 0,I.statusText=`動かせない`,$();return}let i;for(let a=t;a<r.length;a++)if(G(n,{srcType:`tableau`,colIndex:e,cardIndex:a}).length>0){i=a;break}if(i===void 0){I.selectedFrom=void 0,I.statusText=`動かせない`,$();return}I.selectedFrom={srcType:`tableau`,colIndex:e,cardIndex:i};let a=r[i];I.statusText=z(a),$()}function q(e){let t=0,n=0;try{let r=e.buildClearReport?.(!0);if(r){typeof r.moves==`number`?t=r.moves|0:Array.isArray(r.moves)&&(t=r.moves.length|0);let e=r.durationMs??r.timeMs;typeof e==`number`&&(n=e|0)}}catch{}let r=[`V1`,Date.now(),ut(e.mode),e.level|0,e.seed>>>0,t,n].join(`,`);mt(r)}function Vt(){if(!F||F.mode!==`klondike`)return!1;let e=F.state;for(let t=0;t<e.tableaus.length;t++){let n=e.tableaus[t];if(!n.length)continue;let r=n.length-1;if(!n[r].faceUp)continue;let i={srcType:`tableau`,colIndex:t,cardIndex:r};for(let t=0;t<e.foundations.length;t++)if(W(i,{destType:`foundation`,foundationIndex:t}).ok)return!0}return!1}function Ht(){F&&(L||I.cleared||F.mode!==`spider`&&(L=!0,I.statusText=`自動回収中…`,$(),R=window.setInterval(()=>{if(!F){J();return}let e=!1;e=F.mode===`freecell`?xt():F.mode===`klondike`?Vt():!1,e?$():Ut()},100)))}function J(){R!==null&&(clearInterval(R),R=null),L=!1}function Ut(){R!==null&&(clearInterval(R),R=null);let e=F&&Wt(F);if(L=!1,F)if(e&&!I.cleared){I.cleared=!0,I.statusText=`クリア！`,q(F);let e=F.buildClearReport(!0);console.log(`CLEAR REPORT:`,e)}else e||(I.statusText=`自動回収完了`);$()}function Wt(e){return e.mode===`freecell`?yt(e.state):e.mode===`klondike`?Ot(e.state):e.mode===`spider`?Ft(e.state):!1}function Gt(e){if(I.cleared||L)return!1;if(e.mode===`freecell`)return bt(e.state);if(e.mode===`klondike`){let t=e.state;return kt(t)}else if(e.mode===`spider`)return!1;return!1}function Kt(e,t){return e.srcType===t.srcType?e.srcType===`column`?t.srcType===`column`&&e.colIndex===t.colIndex&&e.startIndex===t.startIndex:e.srcType===`freecell`?t.srcType===`freecell`&&e.freecellIndex===t.freecellIndex:t.srcType===`foundation`&&e.foundationIndex===t.foundationIndex:!1}function qt(e,t){return e.srcType===t.srcType?e.srcType===`waste`?t.srcType===`waste`:e.srcType===`foundation`?t.srcType===`foundation`&&e.foundationIndex===t.foundationIndex:t.srcType===`tableau`&&e.colIndex===t.colIndex&&e.cardIndex===t.cardIndex:!1}function Y(e){if(F){if(I.selectedFrom=e,F.mode===`freecell`){let t=e,n=B(F.state,t);I.statusText=z(n)}else if(F.mode===`klondike`){let t=e,n=V(F.state,t);I.statusText=z(n)}else if(F.mode===`spider`){let t=e,n=_t(F.state,t);I.statusText=z(n)}}}function Jt(e){if(I.cleared||!F)return;if(F.mode===`klondike`){let t=e;if(t.srcType===`tableau`){let n=F.state,r=n.tableaus[t.colIndex];if(r&&r.length){let i;for(let e=t.cardIndex;e<r.length;e++)if(Ke(n,t.colIndex,e).length>0){i=e;break}if(i===void 0){I.selectedFrom=void 0,I.statusText=`動かせない`,$();return}e={srcType:`tableau`,colIndex:t.colIndex,cardIndex:i}}}}let t=!1;if(F.mode===`freecell`?I.selectedFrom&&(t=Kt(I.selectedFrom,e)):F.mode===`klondike`?I.selectedFrom&&(t=qt(I.selectedFrom,e)):F.mode===`spider`&&I.selectedFrom&&(t=At(I.selectedFrom,e)),t){I.selectedFrom=void 0,I.statusText=`選択解除`,$();return}if(I.selectedFrom=e,F.mode===`freecell`){let t=e,n=B(F.state,t);I.statusText=z(n)}else if(F.mode===`klondike`){let t=e,n=V(F.state,t);I.statusText=z(n)}else{let t=e,n=_t(F.state,t);I.statusText=z(n)}$()}function Yt(e){if(F&&I.selectedFrom&&!I.cleared){if(F.mode===`freecell`){U(I.selectedFrom,e).ok||(I.selectedFrom=void 0,$());return}if(F.mode===`klondike`){W(I.selectedFrom,e).ok||(I.selectedFrom=void 0,$());return}if(F.mode===`spider`){Pt(I.selectedFrom,e).ok||(I.selectedFrom=void 0,$());return}}}function Xt(){I.selectedFrom&&(I.selectedFrom=void 0,I.statusText=`選択解除`,$())}function Zt(e){F&&(F.mode===`freecell`?U(e,{destType:`foundation`}):F.mode===`klondike`&&Et(e))}function Qt(){if(!F||F.mode!==`klondike`)return;F.snapshot();let e=F.state,t=F.level>=3?3:1;if(!e.stock||e.stock.length===0)if(e.waste&&e.waste.length>0){for(;e.waste.length>0;){let t=e.waste.pop();t&&(t.faceUp=!1,e.stock.push(t))}I.statusText=`山札をリサイクル`}else I.statusText=`山札なし`;else{let n=0;for(let r=0;r<t&&e.stock.length;r++){let t=e.stock.pop();if(!t)break;t.faceUp=!0,e.waste.push(t),n++}I.statusText=n>0?`山札から${n}枚ドロー`:`山札なし`}I.selectedFrom=void 0,I.cleared=!1,$()}function $t(){if(!F)return;J();let e=window.spiderAnim;e&&e.active&&(e.active=!1,e.timer!=null&&(clearTimeout(e.timer),e.timer=null)),F.undo()?(I.selectedFrom=void 0,I.cleared=!1,I.statusText=`1手戻した`,$()):(I.statusText=`戻せない`,$())}function en(){F&&(J(),I.showNewGameMenu=!0,$())}function X(e){if(!F){I.showNewGameMenu=!1,$();return}let t=F.mode,n=F.level,r=null;if(e===`cancel`){I.showNewGameMenu=!1,$();return}e===`retry`?(r=F.seed,n=F.level):e===`level1`?n=1:e===`level2`?n=2:e===`level3`&&(n=3),r===null&&(r=Math.floor(Math.random()*2**32)),J();let i=window.spiderAnim;i&&(i.active=!1,i.timer!=null&&(clearTimeout(i.timer),i.timer=null)),F=new De(t,n,r),I={selectedFrom:void 0,statusText:``,cleared:!1,showNewGameMenu:!1},N=`game`,$()}function tn(e,t){J();let n=window.spiderAnim;n&&(n.active=!1,n.timer!=null&&(clearTimeout(n.timer),n.timer=null));let r=Math.floor(Math.random()*2**32);F=new De(e,t,r),I={selectedFrom:void 0,statusText:``,cleared:!1,showNewGameMenu:!1},N=`game`,$()}function Z(){J();let e=window.spiderAnim;e&&(e.active=!1,e.timer!=null&&(clearTimeout(e.timer),e.timer=null)),N=`menu`,I={selectedFrom:void 0,statusText:``,cleared:!1,showNewGameMenu:!1},F=null,P=void 0,$()}function nn(){Z()}function rn(){if(!F){Z();return}let e=F.mode;J();let t=window.spiderAnim;t&&(t.active=!1,t.timer!=null&&(clearTimeout(t.timer),t.timer=null)),N=`menu`,F=null,I={selectedFrom:void 0,statusText:``,cleared:!1,showNewGameMenu:!1},P=e,$()}var an=900,on=800;function sn(){let e=document.getElementById(`app`);if(!e)return;let t=document.getElementById(`felt-wrapper`);t||(t=document.createElement(`div`),t.id=`felt-wrapper`,t.style.position=`fixed`,t.style.inset=`0`,t.style.overflow=`hidden`,document.body.appendChild(t));let n=document.getElementById(`game-scale-wrapper`);n?(n.style.left=`var(--stage-left)`,n.style.top=`0`,n.style.transformOrigin=`top left`,n.style.transform=`scale(var(--app-scale))`):(n=document.createElement(`div`),n.id=`game-scale-wrapper`,n.style.position=`fixed`,n.style.left=`var(--stage-left)`,n.style.top=`0`,n.style.transformOrigin=`top left`,n.style.transform=`scale(var(--app-scale))`,t.appendChild(n)),e.parentElement!==n&&n.appendChild(e)}function cn(){let e=window.innerWidth,t=window.innerHeight,n=e/an,r=t/on,i=Math.min(1,n,r),a=getComputedStyle(document.documentElement).getPropertyValue(`--user-zoom-mult`).trim(),o=(()=>{let e=parseFloat(a||`1`);return Number.isFinite(e)?Math.max(.5,Math.min(2,e)):1})(),s=i*o,c=an*s,l=Math.max((e-c)/2,0),u=document.documentElement.style;u.setProperty(`--app-scale`,s.toString()),u.setProperty(`--stage-left`,`${l}px`)}function Q(){requestAnimationFrame(cn)}window.addEventListener(`resize`,cn),window.addEventListener(`orientationchange`,cn);function ln(e){let[t,n]=(e.dataset.drop||``).split(`-`),r=n===void 0?void 0:parseInt(n,10);switch(F?.mode){case`freecell`:if(t===`column`&&r!==void 0)return{el:e,dest:{destType:`column`,colIndex:r}};if(t===`freecell`&&r!==void 0)return{el:e,dest:{destType:`freecell`,freecellIndex:r}};if(t===`foundation`)return{el:e,dest:{destType:`foundation`,foundationIndex:r}};break;case`klondike`:if(t===`tableau`&&r!==void 0)return{el:e,dest:{destType:`tableau`,colIndex:r}};if(t===`foundation`&&r!==void 0)return{el:e,dest:{destType:`foundation`,foundationIndex:r}};break;case`spider`:if(t===`tableau`&&r!==void 0)return{el:e,dest:{destType:`tableau`,colIndex:r}};break}return null}var un=re({buildGhost:(e,t)=>ae(e,t),hitTestDest:(e,t)=>{let n=ie(e,t);return n?ln(n):null},canDrop:()=>!0,onDrop:(e,t)=>{if(F){switch(F.mode){case`freecell`:U(e,t);break;case`klondike`:W(e,t);break;case`spider`:Pt(e,t);break}$()}},onCancel:()=>{},ghostOffset:{x:36,y:50}});function $(){sn();let e=document.getElementById(`app`);if(!e)throw Error(`#app が見つからない`);if(N===`menu`){st(e,P,{onSelectMode:e=>{P=e,$()},onBackModeSelect:()=>{P=void 0,$()},onStartGame:(e,t)=>{tn(e,t)}}),Q();return}if(N===`game`){if(!F)throw Error(`sessionが無いのにgame画面`);let t=Wt(F),n=!!I.cleared||t,r=Gt(F);if(F.mode===`freecell`){let t=F.state,i=x(t),a={};t.columns.forEach((e,n)=>{if(e.length)for(let r=0;r<e.length;r++){let e=S(t,n,r);e.length&&e.length<=i&&(a[n]||(a[n]={}),a[n][r]=!0)}});let o={columns:a,freecells:(()=>{let e={};return t.freecells.forEach((t,n)=>{t&&(e[n]=!0)}),e})(),foundations:(()=>{let e={};return t.foundations.forEach((t,n)=>{t.length>0&&(e[n]=!0)}),e})()},s={},c={},l={};if(I.selectedFrom&&I.selectedFrom.srcType){let e=I.selectedFrom;if(e.srcType===`column`){let n=S(t,e.colIndex,e.startIndex);if(n.length>0&&n.length<=i)for(let t=0;t<n.length;t++){let n=e.startIndex+t;s[e.colIndex]||(s[e.colIndex]={}),s[e.colIndex][n]=!0}}else e.srcType===`freecell`?c[e.freecellIndex]=!0:e.srcType===`foundation`&&(l[e.foundationIndex]=!0)}Ue(e,F,I,o,{columns:s,freecells:c,foundations:l},r,L,n,{onBackToMenu:()=>Z(),onUndoClick:()=>$t(),onFinishClick:()=>Ht(),onNewGameClick:()=>en(),onChooseNewGameOption:e=>X(e),onClearToMenuClick:()=>nn(),onClearReplayClick:()=>rn(),onSelectSource:e=>Jt(e),onColumnCardTap:(e,t)=>{if(I.cleared||!F)return;let n=F.state,r=n.columns[e];if(!r.length)return;let i=[];for(let t=0;t<r.length;t++){let r=S(n,e,t);r.length&&r.length<=x(n)&&i.push(t)}if(!i.length){I.selectedFrom=void 0,I.statusText=`動かせない`,$();return}let a=i.find(e=>e>=t);a===void 0&&(a=i[i.length-1]),I.selectedFrom={srcType:`column`,colIndex:e,startIndex:a};let o=r[a];I.statusText=z(o),$()},onClickDestination:e=>Yt(e),onAutoToFoundation:e=>Zt(e),onDragStart:(e,t)=>{I.cleared||(Y(e),$(),un.startDrag(e,t))},onEmptyBoardClick:()=>Xt()}),Q();return}if(F.mode===`klondike`){it(e,F,I,r,L,n,{onBackToMenu:()=>Z(),onUndoClick:()=>$t(),onFinishClick:()=>Ht(),onNewGameClick:()=>en(),onChooseNewGameOption:e=>X(e),onClearToMenuClick:()=>nn(),onClearReplayClick:()=>rn(),onSelectSource:e=>Jt(e),onClickDestination:e=>Yt(e),onAutoToFoundation:e=>Zt(e),onDragStart:(e,t)=>{I.cleared||(Y(e),$(),un.startDrag(e,t))},onEmptyBoardClick:()=>Xt(),onStockClick:()=>Qt(),onColumnCardTap:(e,t)=>{if(I.cleared||!F)return;let n=F.state,r=n.tableaus[e];if(!r||!r.length){I.selectedFrom=void 0,I.statusText=`動かせない`,$();return}let i;for(let a=t;a<r.length;a++)if(Ke(n,e,a).length>0){i=a;break}if(i===void 0){I.selectedFrom=void 0,I.statusText=`動かせない`,$();return}I.selectedFrom={srcType:`tableau`,colIndex:e,cardIndex:i};let a=r[i];I.statusText=z(a),$()}}),Q();return}if(F.mode===`spider`){let t=F.state,r=zt(t,I.selectedFrom);ot(e,F,I,r,n,{onBackToMenu:()=>Z(),onUndoClick:()=>$t(),onNewGameClick:()=>en(),onChooseNewGameOption:e=>X(e),onClearToMenuClick:()=>nn(),onClearReplayClick:()=>rn(),onSelectSource:e=>Jt(e),onColumnCardTap:(e,t)=>Bt(e,t),onClickDestination:e=>Yt(e),onDragStart:(e,t)=>{I.cleared||(Y(e),$(),un.startDrag(e,t))},onStockClick:()=>It(),onEmptyBoardClick:()=>Xt()}),Q();return}e.innerHTML=`<div style="color:#fff">未実装モード: ${F?.mode}</div>`,Q();return}}te.start(),$();